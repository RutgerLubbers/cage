# Built-in presets for cage
# These are embedded at compile time and available as builtin:<name>
#
# Simplified model:
# - deny: blocks read + write; 'except' restores READ-ONLY access
# - allow: grants read + write access
# - read: grants read-only access (only with strict: true)

presets:
  # Recommended preset for AI coding assistants
  # Denies $HOME broadly, carves out read-only paths, allows writes to CWD + tool configs
  secure:
    extends:
      - "builtin:strict-base"
      - "builtin:secure-home"
      - "builtin:npm"
      - "builtin:cargo"
      - "builtin:java"
      - "builtin:go"
    allow:
      - "."

      # AI coding tools
      - "$HOME/.claude"
      - "$HOME/.config/claude"
      - "$HOME/.config/aider"
      - "$HOME/.config/opencode"
      - "$HOME/.cache/opencode"
      - "$HOME/.codeium"
      - "$HOME/.cody"
      - "$HOME/.continue"
      - "$HOME/.cursor"
      - "$HOME/.tabby"

      # IDE/editor state
      - "$HOME/.config/Code"
      - "$HOME/.config/Cursor"
      - "$HOME/.config/JetBrains"
      - "$HOME/.config/VSCodium"
      - "$HOME/.idea"
      - "$HOME/.vscode"
      - "$HOME/.vscode-server"

      # XDG state directories
      - "$HOME/.local/share"
      - "$HOME/.local/state"

      # General caches
      - "$HOME/.cache"
      - "$HOME/Library/Caches"
    allow-git: true

  # Denies $HOME with carve-outs for safe READ-ONLY paths
  # Use 'allow' to grant write access to specific paths
  secure-home:
    deny:
      - path: "$HOME"
        except:
          # Safe user directories (read-only via except)
          - "$HOME/Code"
          - "$HOME/Desktop"
          - "$HOME/Developer"
          - "$HOME/Documents"
          - "$HOME/Downloads"
          - "$HOME/Movies"
          - "$HOME/Music"
          - "$HOME/Pictures"
          - "$HOME/Projects"
          - "$HOME/Videos"
          - "$HOME/src"
          - "$HOME/workspace"

          # Go source (separate from GOPATH cache)
          - "$HOME/go/src"

          # Shell configs (read-only)
          - "$HOME/.bashrc"
          - "$HOME/.zshrc"
          - "$HOME/.profile"
          - "$HOME/.config/fish"
          - "$HOME/.config/starship.toml"

          # Git config (read-only)
          - "$HOME/.gitconfig"
          - "$HOME/.config/git"

          # Editor configs (read-only)
          - "$HOME/.vimrc"
          - "$HOME/.config/nvim"

  # Minimal system read access with strict mode enabled
  strict-base:
    strict: true
    read:
      # macOS system paths
      - "/Applications"
      - "/Library"
      - "/System"
      - "/private/var"
      - "/private/var/folders"

      # Unix standard paths
      - "/bin"
      - "/dev"
      - path: "/etc"
        eval-symlinks: true
      - "/lib"
      - "/lib64"
      - "/opt"
      - "/proc"
      - "/sbin"
      - "/sys"
      - path: "/tmp"
        eval-symlinks: true
      - "/usr"
      - path: "/var"
        eval-symlinks: true

  # Write access for Node.js development (additive - use with builtin:secure or --allow .)
  npm:
    allow:
      - "$HOME/.npm"
      - "$HOME/.bun"
      - "$HOME/.cache/npm"
      - "node_modules"

  # Write access for Rust development (additive - use with builtin:secure or --allow .)
  cargo:
    allow:
      - "$HOME/.cargo"
      - "$HOME/.rustup"
      - "target"

  # Write access for Java/JVM development (additive - use with builtin:secure or --allow .)
  java:
    allow:
      - "$HOME/.m2"
      - "$HOME/.gradle"
      - "$HOME/.java"
      - "target"
      - "build"

  # Write access for Go development (additive - use with builtin:secure or --allow .)
  go:
    allow:
      - "$HOME/go"
      - "$HOME/.cache/go-build"
